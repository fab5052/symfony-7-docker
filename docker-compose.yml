# ./docker-compose.yml

services:

 server:
        build:
            context: .
            dockerfile: ./automation/docker/Dockerfile
        container_name: server
        volumes:
            - ./:/var/www/html
        links:
            - mysql
        ports:
            - 81:80  

#  dev:
#     image: bricefa5052/symfony-7-docker:latest
#     command: sleep infinity
#     volumes:
#       - ../.:/workspace
#     ports:
#       - "${BACKEND_PORT:-80}:80"
#     environment:
#       DATABASE_URL: "mysql://${MYSQL_USER:-admin}:${MYSQL_PASSWORD:-Afpa1234}@database:3306/${MYSQL_DATABASE:-green-village}"
#       MAILER_DSN: "smtp://mailer:1025"   

 mysql:
    image: mysql:${MYSQL_VERSION:-8}-oracle
    environment:
      MYSQL_DATABASE: ${MYSQL_DATABASE:-green-village}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD:-Afpa1234}
      MYSQL_USER: ${MYSQL_USER:-admin}
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD:-toor}
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      timeout: 5s
      retries: 5
      start_period: 60s
    volumes:
      - database_data:/var/lib/mysql:rw
    ports:
      - "${DB_PORT:-3307}:3306" 

 phpmyadmin:
        image: phpmyadmin:latest
        container_name: phpmyadmin
        environment:
            - PMA_HOST=${DB_HOST:-mysql}
            - PMA_USER=${DB_USER:-admin}
            - PMA_PASSWORD=${DB_PASSWORD:-Afpa1234}
        links:
            - mysql
        ports:
            - 8090:80

 mailer:
        image: schickling/mailcatcher
        container_name: mailcatcher
        ports: 
            - 1025:1025
            - 1080:1080

###> doctrine/doctrine-bundle ###
#  database:
#    image: postgres:${POSTGRES_VERSION:-16}-alpine
#    environment:
#      POSTGRES_DB: ${POSTGRES_DB:-app}
#      # You should definitely change the password in production
#      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-!ChangeMe!}
#      POSTGRES_USER: ${POSTGRES_USER:-app}
#    volumes:
#      - database_data:/var/lib/postgresql/data:rw
     # You may use a bind-mounted host directory instead, so that it is harder to accidentally remove the volume and lose all your data!
     # - ./docker/db/data:/var/lib/postgresql/data:rw
###< doctrine/doctrine-bundle ###

volumes:
  database_data:
###> doctrine/doctrine-bundle ###

###< doctrine/doctrine-bundle ###
